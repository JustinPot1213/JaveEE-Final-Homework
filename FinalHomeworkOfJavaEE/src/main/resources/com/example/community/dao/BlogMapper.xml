<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.community.dao.BlogMapper">

    <resultMap id="BlogResultMap" type="com.example.community.domain.Blog">
        <result column="BlogId" jdbcType="INTEGER" property="id" />
        <result column="Header" jdbcType="VARCHAR" property="header" />
        <result column="Text" jdbcType="VARCHAR" property="text" />
        <result column="Date" jdbcType="TIMESTAMP" javaType="Date" property="date"/>
        <result column="Date" jdbcType="TIMESTAMP" javaType="String" property="time"/>
        <association property="user" javaType="com.example.community.domain.User"
                     select="com.example.community.dao.UserMapper.getById" column="UserId"/>
        <collection property="comments" ofType="com.example.community.domain.Comment"
                    select="com.example.community.dao.CommentMapper.getByBlogId" column="BlogId"/>
    </resultMap>

    <select id= "getByUserName" resultMap="BlogResultMap">
        select * from blogs where UserId in (
            select users.UserId from users where Name = #{name}
            )
    </select>

    <select id="getByUserId" resultMap="BlogResultMap">
        select * from blogs where UserId = #{userId}
    </select>

    <select id="getById" resultMap="BlogResultMap">
        select * from blogs where BlogId = #{id}
    </select>

    <insert id="addBlog" parameterType="com.example.community.domain.Blog" useGeneratedKeys="true" keyColumn="CommentId">
        insert into blogs(BlogId, Header, Text, UserId, Date)
        values(#{id}, #{header}, #{text}, #{user.id}, #{date})
    </insert>

</mapper>